var require=function(t,e){var r=require.resolve(t,e||"/"),i=require.modules[r];if(!i)throw new Error("Failed to resolve module "+t+", tried "+r);var n=i._cached?i._cached:i();return n},__require=require;require.paths=[],require.modules={},require.extensions=[".js",".coffee"],require.resolve=function(){var t=["assert","events","fs","path","vm"].reduce(function(t,e){return t[e]=!0,t},{});return function(e,r){function i(t){var e;e="/"===t?[""]:o.normalize(t).split(/\/+/);for(var r=[],i=e.length-1;i>=0;i--)if("node_modules"!==e[i]){var n=e.slice(0,i+1).join("/")+"/node_modules";r.push(n)}return r}function n(t,e){for(var r=i(e),n=0;n<r.length;n++){var o=r[n],l=a(o+"/"+t);if(l)return l;var c=s(o+"/"+t);if(c)return c}var l=a(t);return l?l:void 0}function s(t){t=t.replace(/\/+$/,"");var e=t+"/package.json";if(require.modules[e]){var r=require.modules[e](),i=r.browserify;if("object"==typeof i&&i.main){var n=a(o.resolve(t,i.main));if(n)return n}else if("string"==typeof i){var n=a(o.resolve(t,i));if(n)return n}else if(r.main){var n=a(o.resolve(t,r.main));if(n)return n}}return a(t+"/index")}function a(t){if(require.modules[t])return t;for(var e=0;e<require.extensions.length;e++){var r=require.extensions[e];if(require.modules[t+r])return t+r}}if(r||(r="/"),t[e])return e;var o=require.modules.path(),l=r||".";if(e.match(/^(?:\.\.?\/|\/)/)){var c=a(o.resolve(l,e))||s(o.resolve(l,e));if(c)return c}var u=n(e,l);if(u)return u;throw new Error("Cannot find module '"+e+"'")}}(),require.alias=function(t,e){var r=require.modules.path(),i=null;try{i=require.resolve(t+"/package.json","/")}catch(n){i=require.resolve(t,"/")}var s=r.dirname(i);Object.keys(require.modules).forEach(function(t){if(t.slice(0,s.length+1)===s+"/"){var r=t.slice(s.length);require.modules[e+r]=require.modules[s+r]}else t===s&&(require.modules[e]=require.modules[s])})},"undefined"==typeof process&&(process={}),process.nextTick||(process.nextTick=function(t){setTimeout(t,0)}),process.title||(process.title="browser"),process.binding||(process.binding=function(t){if("evals"===t)return require("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),require.modules.path=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,".")};return r.resolve=function(){return __require.resolve(name,".")},r.modules=__require.modules,__require.modules.path._cached=t.exports,function(){function t(t,e){for(var r=0,i=t.length;i>=0;i--){var n=t[i];"."==n?t.splice(i,1):".."===n?(t.splice(i,1),r++):r&&(t.splice(i,1),r--)}if(e)for(;r--;r)t.unshift("..");return t}var r=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;e.resolve=function(){for(var e="",r=!1,i=arguments.length;i>=-1&&!r;i--){var n=i>=0?arguments[i]:process.cwd();"string"==typeof n&&n&&(e=n+"/"+e,r="/"===n.charAt(0))}return e=t(e.split("/").filter(function(t){return!!t}),!r).join("/"),(r?"/":"")+e||"."},e.normalize=function(e){var r="/"===e.charAt(0),i="/"===e.slice(-1);return e=t(e.split("/").filter(function(t){return!!t}),!r).join("/"),!e&&!r&&(e="."),e&&i&&(e+="/"),(r?"/":"")+e},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(t.filter(function(t){return t&&"string"==typeof t}).join("/"))},e.dirname=function(t){var e=r.exec(t)[1]||"",i=!1;return e?1===e.length||i&&e.length<=3&&":"===e.charAt(1)?e:e.substring(0,e.length-1):"."},e.basename=function(t,e){var i=r.exec(t)[2]||"";return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},e.extname=function(t){return r.exec(t)[3]||""}}.call(t.exports),__require.modules.path._cached=t.exports,t.exports},require.modules["/util.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/util.coffee"]._cached=t.exports,function(){(function(){var t,r,i,n,s,a,o;o=Math.sqrt(3),i=Math.PI/6,n=Math.PI/3,s=Math.sin(i),t=Math.cos(i),a=Math.sin(n),r=Math.cos(n),e.to_xy=function(e,r,i,n){var a,l,c,u,h,f,p,d,g,m,v;return c=o*e/6,a=o*e/3,l=o*e/2,h=0,g=r*a,f=-i*t*a,m=-i*s*a,p=n*t*a,v=-n*s*a,u=h+f+p,d=g+m+v,[u,d]},e.to_uvw=function(t,e,r){var i,s,a,l,c,u,h,f;return 0===e&&0===r?[0,0,0]:(c=o*t/6,i=o*t/3,a=o*t/2,u=Math.floor((i+r)/a),r>0?(s=-1,l=c):(s=1,l=i),h=s*Math.floor((Math.cos(n-Math.atan(e/r))*Math.sqrt(Math.pow(e,2)+Math.pow(r,2))+l)/a),r>0?(s=1,l=i):(s=-1,l=c),f=s*Math.floor((Math.cos(2*n-Math.atan(e/r))*Math.sqrt(Math.pow(e,2)+Math.pow(r,2))+l)/a),[u,h,f])},e.valid_w=function(t,e){return[t-e,t-e+1]}}).call(this)}.call(t.exports),__require.modules["/util.coffee"]._cached=t.exports,t.exports},require.modules["/game.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/game.coffee"]._cached=t.exports,function(){(function(){var t,i,n;t=r("./common").BiromError,i=r("./grid").Grid,n=r("./triangle").Triangle,e.Game=function(){function t(t){this.grid=null!=t?t:new i,this.grid.set(this.red=new n(0,0,0,TRI_TYPE_START)),this.grid.set(new n(0,1,0,TRI_TYPE_START)),this.grid.set(new n(-1,1,0,TRI_TYPE_START)),this.grid.set(new n(-1,1,1,TRI_TYPE_START))}return t.prototype.put=function(t){var e,r,i,n,s,a,o,l,c,u,h,f,p,d,g;if(i=this.grid.deepCopy(),t.validate(i))for(p=t.triangles,o=0,u=p.length;u>o;o++)a=p[o],i.set(a);for(i.fillBorderTriangles(),d=s=i.getPointTriangles(t.triangles),l=0,h=d.length;h>l;l++)n=d[l],i.set(n);for(g=e=i.getCapturedTriangles(t.triangles),c=0,f=g.length;f>c;c++)n=g[c],n.type=TRI_TYPE_COMMON,n.playerId=void 0,i.set(n);if(r=_(t.triangles).first().playerId,i.isEncircledBy(this.red,r))throw{playerWon:r};return this.grid=i.deepCopy(),[t,{triangles:e},{triangles:s}]},t}()}).call(this)}.call(t.exports),__require.modules["/game.coffee"]._cached=t.exports,t.exports},require.modules["/common.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/common.coffee"]._cached=t.exports,function(){(function(){var t;t="undefined"!=typeof global&&null!==global?global:window,t._=r("underscore"),t.TRI_TYPE_START=0,t.TRI_TYPE_COMMON=1,t.TRI_TYPE_POINT=2,t.TRI_TYPE_COUNTER=3,t.TRI_TYPE_BORDER=4,t.EXC_BAD_REQUEST=400,t.EXC_ERROR=500,e.BiromError=function(){function t(t,e){this.message=null!=t?t:"Undefined Error",this.code=null!=e?e:EXC_ERROR}return t.prototype.toString=function(){return""+this.message+" ["+this.code+"]"},t}(),e.bfs=function(t,r){var i,n,s,a,o,l;for(o=[],o.unshift(t),a=1e3,s=0,l=[];!_(o).isEmpty();){if(++s===a)throw new e.BiromError("Endless loop in BFS ("+s+" iterations)",EXC_ERROR);i=o.pop(),l.push(function(){var t,e,s,a;for(s=r(i),a=[],t=0,e=s.length;e>t;t++)n=s[t],a.push(o.unshift(n));return a}())}return l},e.isWithin=function(t,e,r){var i,n,s;return _([t.u,e.u]).min()<=(i=r.u)&&i<=_([t.u,e.u]).max()&&_([t.v,e.v]).min()<=(n=r.v)&&n<=_([t.v,e.v]).max()&&_([t.w,e.w]).min()<=(s=r.w)&&s<=_([t.w,e.w]).max()}}).call(this)}.call(t.exports),__require.modules["/common.coffee"]._cached=t.exports,t.exports},require.modules["/node_modules/underscore/package.json"]=function(){var t={exports:{}},e=(t.exports,function(t){return __require(t,"/node_modules/underscore")});return e.resolve=function(){return __require.resolve(name,"/node_modules/underscore")},e.modules=__require.modules,__require.modules["/node_modules/underscore/package.json"]._cached=t.exports,function(){t.exports={name:"underscore",description:"JavaScript's functional programming helper library.",homepage:"http://documentcloud.github.com/underscore/",keywords:["util","functional","server","client","browser"],author:"Jeremy Ashkenas <jeremy@documentcloud.org>",contributors:[],dependencies:[],repository:{type:"git",url:"git://github.com/documentcloud/underscore.git"},main:"underscore.js",version:"1.1.6"}}.call(t.exports),__require.modules["/node_modules/underscore/package.json"]._cached=t.exports,t.exports},require.modules["/node_modules/underscore/underscore.js"]=function(){var t={exports:{}},e=(t.exports,function(t){return __require(t,"/node_modules/underscore")});return e.resolve=function(){return __require.resolve(name,"/node_modules/underscore")},e.modules=__require.modules,__require.modules["/node_modules/underscore/underscore.js"]._cached=t.exports,function(){!function(){var e=this,r=e._,i={},n=Array.prototype,s=Object.prototype,a=Function.prototype,o=n.slice,l=n.unshift,c=s.toString,u=s.hasOwnProperty,h=n.forEach,f=n.map,p=n.reduce,d=n.reduceRight,g=n.filter,m=n.every,v=n.some,y=n.indexOf,x=n.lastIndexOf,b=Array.isArray,w=Object.keys,_=a.bind,k=function(t){return new A(t)};"undefined"!=typeof t&&t.exports?(t.exports=k,k._=k):e._=k,k.VERSION="1.1.6";var C=k.each=k.forEach=function(t,e,r){if(null!=t)if(h&&t.forEach===h)t.forEach(e,r);else if(k.isNumber(t.length)){for(var n=0,s=t.length;s>n;n++)if(e.call(r,t[n],n,t)===i)return}else for(var a in t)if(u.call(t,a)&&e.call(r,t[a],a,t)===i)return};k.map=function(t,e,r){var i=[];return null==t?i:f&&t.map===f?t.map(e,r):(C(t,function(t,n,s){i[i.length]=e.call(r,t,n,s)}),i)},k.reduce=k.foldl=k.inject=function(t,e,r,i){var n=void 0!==r;if(null==t&&(t=[]),p&&t.reduce===p)return i&&(e=k.bind(e,i)),n?t.reduce(e,r):t.reduce(e);if(C(t,function(t,s,a){n||0!==s?r=e.call(i,r,t,s,a):(r=t,n=!0)}),!n)throw new TypeError("Reduce of empty array with no initial value");return r},k.reduceRight=k.foldr=function(t,e,r,i){if(null==t&&(t=[]),d&&t.reduceRight===d)return i&&(e=k.bind(e,i)),void 0!==r?t.reduceRight(e,r):t.reduceRight(e);var n=(k.isArray(t)?t.slice():k.toArray(t)).reverse();return k.reduce(n,e,r,i)},k.find=k.detect=function(t,e,r){var i;return T(t,function(t,n,s){return e.call(r,t,n,s)?(i=t,!0):void 0}),i},k.filter=k.select=function(t,e,r){var i=[];return null==t?i:g&&t.filter===g?t.filter(e,r):(C(t,function(t,n,s){e.call(r,t,n,s)&&(i[i.length]=t)}),i)},k.reject=function(t,e,r){var i=[];return null==t?i:(C(t,function(t,n,s){e.call(r,t,n,s)||(i[i.length]=t)}),i)},k.every=k.all=function(t,e,r){var n=!0;return null==t?n:m&&t.every===m?t.every(e,r):(C(t,function(t,s,a){return(n=n&&e.call(r,t,s,a))?void 0:i}),n)};var T=k.some=k.any=function(t,e,r){e||(e=k.identity);var n=!1;return null==t?n:v&&t.some===v?t.some(e,r):(C(t,function(t,s,a){return(n=e.call(r,t,s,a))?i:void 0}),n)};k.include=k.contains=function(t,e){var r=!1;return null==t?r:y&&t.indexOf===y?-1!=t.indexOf(e):(T(t,function(t){return(r=t===e)?!0:void 0}),r)},k.invoke=function(t,e){var r=o.call(arguments,2);return k.map(t,function(t){return(e.call?e||t:t[e]).apply(t,r)})},k.pluck=function(t,e){return k.map(t,function(t){return t[e]})},k.max=function(t,e,r){if(!e&&k.isArray(t))return Math.max.apply(Math,t);var i={computed:-1/0};return C(t,function(t,n,s){var a=e?e.call(r,t,n,s):t;a>=i.computed&&(i={value:t,computed:a})}),i.value},k.min=function(t,e,r){if(!e&&k.isArray(t))return Math.min.apply(Math,t);var i={computed:1/0};return C(t,function(t,n,s){var a=e?e.call(r,t,n,s):t;a<i.computed&&(i={value:t,computed:a})}),i.value},k.sortBy=function(t,e,r){return k.pluck(k.map(t,function(t,i,n){return{value:t,criteria:e.call(r,t,i,n)}}).sort(function(t,e){var r=t.criteria,i=e.criteria;return i>r?-1:r>i?1:0}),"value")},k.sortedIndex=function(t,e,r){r||(r=k.identity);for(var i=0,n=t.length;n>i;){var s=i+n>>1;r(t[s])<r(e)?i=s+1:n=s}return i},k.toArray=function(t){return t?t.toArray?t.toArray():k.isArray(t)?t:k.isArguments(t)?o.call(t):k.values(t):[]},k.size=function(t){return k.toArray(t).length},k.first=k.head=function(t,e,r){return null==e||r?t[0]:o.call(t,0,e)},k.rest=k.tail=function(t,e,r){return o.call(t,null==e||r?1:e)},k.last=function(t){return t[t.length-1]},k.compact=function(t){return k.filter(t,function(t){return!!t})},k.flatten=function(t){return k.reduce(t,function(t,e){return k.isArray(e)?t.concat(k.flatten(e)):(t[t.length]=e,t)},[])},k.without=function(t){var e=o.call(arguments,1);return k.filter(t,function(t){return!k.include(e,t)})},k.uniq=k.unique=function(t,e){return k.reduce(t,function(t,r,i){return 0!=i&&(e===!0?k.last(t)==r:k.include(t,r))||(t[t.length]=r),t},[])},k.intersect=function(t){var e=o.call(arguments,1);return k.filter(k.uniq(t),function(t){return k.every(e,function(e){return k.indexOf(e,t)>=0})})},k.zip=function(){for(var t=o.call(arguments),e=k.max(k.pluck(t,"length")),r=Array(e),i=0;e>i;i++)r[i]=k.pluck(t,""+i);return r},k.indexOf=function(t,e,r){if(null==t)return-1;var i,n;if(r)return i=k.sortedIndex(t,e),t[i]===e?i:-1;if(y&&t.indexOf===y)return t.indexOf(e);for(i=0,n=t.length;n>i;i++)if(t[i]===e)return i;return-1},k.lastIndexOf=function(t,e){if(null==t)return-1;if(x&&t.lastIndexOf===x)return t.lastIndexOf(e);for(var r=t.length;r--;)if(t[r]===e)return r;return-1},k.range=function(t,e,r){arguments.length<=1&&(e=t||0,t=0),r=arguments[2]||1;for(var i=Math.max(Math.ceil((e-t)/r),0),n=0,s=Array(i);i>n;)s[n++]=t,t+=r;return s},k.bind=function(t,e){if(t.bind===_&&_)return _.apply(t,o.call(arguments,1));var r=o.call(arguments,2);return function(){return t.apply(e,r.concat(o.call(arguments)))}},k.bindAll=function(t){var e=o.call(arguments,1);return 0==e.length&&(e=k.functions(t)),C(e,function(e){t[e]=k.bind(t[e],t)}),t},k.memoize=function(t,e){var r={};return e||(e=k.identity),function(){var i=e.apply(this,arguments);return u.call(r,i)?r[i]:r[i]=t.apply(this,arguments)}},k.delay=function(t,e){var r=o.call(arguments,2);return setTimeout(function(){return t.apply(t,r)},e)},k.defer=function(t){return k.delay.apply(k,[t,1].concat(o.call(arguments,1)))};var E=function(t,e,r){var i;return function(){var n=this,s=arguments,a=function(){i=null,t.apply(n,s)};r&&clearTimeout(i),(r||!i)&&(i=setTimeout(a,e))}};k.throttle=function(t,e){return E(t,e,!1)},k.debounce=function(t,e){return E(t,e,!0)},k.once=function(t){var e,r=!1;return function(){return r?e:(r=!0,e=t.apply(this,arguments))}},k.wrap=function(t,e){return function(){var r=[t].concat(o.call(arguments));return e.apply(this,r)}},k.compose=function(){var t=o.call(arguments);return function(){for(var e=o.call(arguments),r=t.length-1;r>=0;r--)e=[t[r].apply(this,e)];return e[0]}},k.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},k.keys=w||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var r in t)u.call(t,r)&&(e[e.length]=r);return e},k.values=function(t){return k.map(t,k.identity)},k.functions=k.methods=function(t){return k.filter(k.keys(t),function(e){return k.isFunction(t[e])}).sort()},k.extend=function(t){return C(o.call(arguments,1),function(e){for(var r in e)void 0!==e[r]&&(t[r]=e[r])}),t},k.defaults=function(t){return C(o.call(arguments,1),function(e){for(var r in e)null==t[r]&&(t[r]=e[r])}),t},k.clone=function(t){return k.isArray(t)?t.slice():k.extend({},t)},k.tap=function(t,e){return e(t),t},k.isEqual=function(t,e){if(t===e)return!0;var r=typeof t,i=typeof e;if(r!=i)return!1;if(t==e)return!0;if(!t&&e||t&&!e)return!1;if(t._chain&&(t=t._wrapped),e._chain&&(e=e._wrapped),t.isEqual)return t.isEqual(e);if(k.isDate(t)&&k.isDate(e))return t.getTime()===e.getTime();if(k.isNaN(t)&&k.isNaN(e))return!1;if(k.isRegExp(t)&&k.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.ignoreCase===e.ignoreCase&&t.multiline===e.multiline;if("object"!==r)return!1;if(t.length&&t.length!==e.length)return!1;var n=k.keys(t),s=k.keys(e);if(n.length!=s.length)return!1;for(var a in t)if(!(a in e&&k.isEqual(t[a],e[a])))return!1;return!0},k.isEmpty=function(t){if(k.isArray(t)||k.isString(t))return 0===t.length;for(var e in t)if(u.call(t,e))return!1;return!0},k.isElement=function(t){return!!t&&1==t.nodeType},k.isArray=b||function(t){return"[object Array]"===c.call(t)},k.isArguments=function(t){return!!t&&!!u.call(t,"callee")},k.isFunction=function(t){return!!(t&&t.constructor&&t.call&&t.apply)},k.isString=function(t){return!!(""===t||t&&t.charCodeAt&&t.substr)},k.isNumber=function(t){return!!(0===t||t&&t.toExponential&&t.toFixed)},k.isNaN=function(t){return t!==t},k.isBoolean=function(t){return t===!0||t===!1},k.isDate=function(t){return!!(t&&t.getTimezoneOffset&&t.setUTCFullYear)},k.isRegExp=function(t){return!(!(t&&t.test&&t.exec)||!t.ignoreCase&&t.ignoreCase!==!1)},k.isNull=function(t){return null===t},k.isUndefined=function(t){return void 0===t},k.noConflict=function(){return e._=r,this},k.identity=function(t){return t},k.times=function(t,e,r){for(var i=0;t>i;i++)e.call(r,i)},k.mixin=function(t){C(k.functions(t),function(e){M(e,k[e]=t[e])})};var B=0;k.uniqueId=function(t){var e=B++;return t?t+e:e},k.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},k.template=function(t,e){var r=k.templateSettings,i="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(r.interpolate,function(t,e){return"',"+e.replace(/\\'/g,"'")+",'"}).replace(r.evaluate||null,function(t,e){return"');"+e.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",n=new Function("obj",i);return e?n(e):n};var A=function(t){this._wrapped=t};k.prototype=A.prototype;var N=function(t,e){return e?k(t).chain():t},M=function(t,e){A.prototype[t]=function(){var t=o.call(arguments);return l.call(t,this._wrapped),N(e.apply(k,t),this._chain)}};k.mixin(k),C(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=n[t];A.prototype[t]=function(){return e.apply(this._wrapped,arguments),N(this._wrapped,this._chain)}}),C(["concat","join","slice"],function(t){var e=n[t];A.prototype[t]=function(){return N(e.apply(this._wrapped,arguments),this._chain)}}),A.prototype.chain=function(){return this._chain=!0,this},A.prototype.value=function(){return this._wrapped}}()}.call(t.exports),__require.modules["/node_modules/underscore/underscore.js"]._cached=t.exports,t.exports},require.modules["/grid.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/grid.coffee"]._cached=t.exports,function(){(function(){var t,i,n,s,a=Object.prototype.hasOwnProperty,o=function(t,e){return function(){return t.apply(e,arguments)}},l=Array.prototype.indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(this[e]===t)return e;return-1};s=r("./common"),i=s.bfs,n=s.isWithin,t=r("./triangle").Triangle,e.Grid=function(){function e(t){this.triangles=null!=t?t:{}}return e.prototype.set=function(e){if(!(e instanceof t))throw new BiromError("Argument is not a triangle",EXC_BAD_REQUEST);return this.triangles[""+e]=e},e.prototype.get=function(t,e,r){return this.triangles[""+t+"/"+e+"/"+r]},e.prototype.getNeighbours=function(t){var e,r;return r=function(){var r,i,n,s;for(n=t.getNeighbourCoords(),s=[],r=0,i=n.length;i>r;r++)e=n[r],s.push(this.get(e.u,e.v,e.w));return s}.call(this),_(r).compact()},e.prototype.getCloseNeighbours=function(t){var e,r;return r=function(){var r,i,n,s;for(n=t.getCloseNeighbourCoords(),s=[],r=0,i=n.length;i>r;r++)e=n[r],s.push(this.get(e.u,e.v,e.w));return s}.call(this),_(r).compact()},e.prototype.getBoundingBox=function(){var t,e,r,i,n,s;return n=_(this.triangles).pluck("u"),s=_(this.triangles).pluck("v"),[{u:t=_(n).max(),v:e=_(s).max(),w:-t-e},{u:r=_(n).min(),v:i=_(s).min(),w:1-r-i}]},e.prototype.deepCopy=function(){var r,i,n,s;i={},s=this.triangles;for(r in s)a.call(s,r)&&(n=s[r],n.type!==TRI_TYPE_BORDER&&(i[r]=new t(n.u,n.v,n.w,n.type,n.playerId)));return new e(i)},e.prototype.fillBorderTriangles=function(){var e,r,s,a,l;return l=this.getBoundingBox(),e=l[0],s=l[1],a=new t(e.u+1,e.v+1,e.w-2,TRI_TYPE_BORDER),r=new t(s.u-1,s.v-1,s.w+2,TRI_TYPE_BORDER),this.set(a),i(a,o(function(e){var i,s,o,l,c,u;for(c=e.getCloseNeighbourCoords(),u=[],o=0,l=c.length;l>o;o++)i=c[o],n(a,r,i)&&null==this.get(i.u,i.v,i.w)&&(s=new t(i.u,i.v,i.w,TRI_TYPE_BORDER),this.set(s),u.push(s));return u},this))},e.prototype.getPointTriangles=function(e){var r,n,s,a,c;if(!_(e).isArray())throw new BiromError("Argument is not an array",EXC_BAD_REQUEST);return r=function(){var t,r,i;for(i=[],t=0,r=e.length;r>t;t++)n=e[t],i.push(""+n.u+"/"+n.v+"/"+n.w);return i}(),s={},a=[],c=_(e).first(),i(c,o(function(e){var i,n,o,u;return o=function(){var t,n,a,o,c;for(a=e.getCloseNeighbourCoords(),c=[],t=0,n=a.length;n>t;t++)i=a[t],(null==this.get(i.u,i.v,i.w)||(o=""+i.u+"/"+i.v+"/"+i.w,l.call(r,o)>=0))&&!s[""+i.u+"/"+i.v+"/"+i.w]&&c.push(i);return c}.call(this),u=function(){var e,r,l;for(l=[],e=0,r=o.length;r>e;e++)i=o[e],s[""+i.u+"/"+i.v+"/"+i.w]=!0,n=this.get(i.u,i.v,i.w),null==n&&(n=new t(i.u,i.v,i.w,TRI_TYPE_POINT,c.playerId),a.push(n)),l.push(n);return l}.call(this)},this)),a},e.prototype.isEncircledBy=function(t,e){var r,n;if(n={},t.type!==TRI_TYPE_START)throw new BiromError("Argument is not a red birom triangle",EXC_BAD_REQUEST);r=!0;try{i(t,o(function(t){var r,i,s,a,o;for(i=[],o=this.getCloseNeighbours(t),s=0,a=o.length;a>s;s++){if(r=o[s],r.type===TRI_TYPE_BORDER)throw"BorderReached";(r.type===TRI_TYPE_START||r.type===TRI_TYPE_COUNTER&&r.playerId!==e)&&!n[""+r.u+"/"+r.v+"/"+r.w]&&i.push(r),n[""+r.u+"/"+r.v+"/"+r.w]=!0}return i},this))}catch(s){if("BorderReached"!==s)throw s;r=!1}return r},e.prototype._getCapturedBranch=function(t){var e,r;r={},e=[],r[""+t.u+"/"+t.v+"/"+t.w]=!0;try{i(t,o(function(t){var i,n,s,a,o;for(e.push(t),n=this.getCloseNeighbours(t),s=[],a=0,o=n.length;o>a;a++){if(i=n[a],i.type===TRI_TYPE_BORDER)throw"EndOfBranch";i.type===TRI_TYPE_COUNTER&&i.playerId===t.playerId&&!r[""+i.u+"/"+i.v+"/"+i.w]&&s.push(i),r[""+i.u+"/"+i.v+"/"+i.w]=!0}return s},this))}catch(n){if("EndOfBranch"!==n)throw n;e=[]}return e},e.prototype.getCapturedTriangles=function(t){var e,r,n,s,a;if(!_(t).isArray())throw new BiromError("Argument is not an array",EXC_BAD_REQUEST);return r=function(){var e,r,i;for(i=[],e=0,r=t.length;r>e;e++)n=t[e],i.push(""+n.u+"/"+n.v+"/"+n.w);return i}(),s={},a=_(t).first(),e=[],i(a,o(function(t){var i,n,o,c,u,h,f;for(c=this.getCloseNeighbours(t),u=function(){var t,e,i,n;for(n=[],t=0,e=c.length;e>t;t++)o=c[t],(o.type===TRI_TYPE_POINT&&o.playerId===a.playerId||(i=""+o.u+"/"+o.v+"/"+o.w,l.call(r,i)>=0))&&!s[""+o.u+"/"+o.v+"/"+o.w]&&(s[""+o.u+"/"+o.v+"/"+o.w]=!0,n.push(o));return n}(),i=function(){var e,r,i;for(i=[],e=0,r=c.length;r>e;e++)o=c[e],o.type===TRI_TYPE_COUNTER&&o.playerId!==t.playerId&&!s[""+o]&&i.push(o);return i}(),h=0,f=i.length;f>h;h++)n=i[h],s[""+n.u+"/"+n.v+"/"+n.w]=!0,e.push(this._getCapturedBranch(n));return u},this)),_(e).flatten()},e}()}).call(this)}.call(t.exports),__require.modules["/grid.coffee"]._cached=t.exports,t.exports},require.modules["/triangle.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/triangle.coffee"]._cached=t.exports,function(){(function(){var t;t=r("./common").BiromError,e.Triangle=function(){function e(e,r,i,n,s){var a;if(this.type=n,this.playerId=s,this.u=parseInt(e),this.v=parseInt(r),this.w=parseInt(i),null==this.u||null==this.v||null==this.w||_.isNaN(this.u)||_.isNaN(this.v)||_.isNaN(this.w))throw new t("Invalid or missing coordinates",EXC_BAD_REQUEST);if(!(0<=(a=this.u+this.v+this.w)&&1>=a))throw new t("Invalid coordinates",EXC_BAD_REQUEST)}return e.prototype.isFacingUp=function(){return this.u+this.v+this.w===0},e.prototype.isCloseNeighbour=function(t){return Math.abs(this.u-t.u)+Math.abs(this.v-t.v)+Math.abs(this.w-t.w)===1},e.prototype.getNeighbourCoords=function(){var t,e,r,i,n,s,a,o,l,c,u;for(t=[],l=e=this.u-1,r=this.u+1;r>=e?r>=l:l>=r;r>=e?l++:l--)for(c=i=this.v-1,n=this.v+1;n>=i?n>=c:c>=n;n>=i?c++:c--)for(u=s=this.w-1,a=this.w+1;a>=s?a>=u:u>=a;a>=s?u++:u--)0<=(o=l+c+u)&&1>=o&&(l!==this.u||c!==this.v||u!==this.w)&&t.push({u:l,v:c,w:u});return t},e.prototype.getCloseNeighbourCoords=function(){var t;return t=this.isFacingUp()?1:-1,[{u:this.u+t,v:this.v,w:this.w},{u:this.u,v:this.v+t,w:this.w},{u:this.u,v:this.v,w:this.w+t}]},e.prototype.getVertices=function(){return this.isFacingUp()?[{x:this.u,y:this.v},{x:this.u-1,y:this.v},{x:this.u,y:this.v-1}]:[{x:this.u,y:this.v-1},{x:this.u-1,y:this.v},{x:this.u-1,y:this.v-1}]},e.prototype.toString=function(){return""+this.u+"/"+this.v+"/"+this.w},e}()}).call(this)}.call(t.exports),__require.modules["/triangle.coffee"]._cached=t.exports,t.exports},require.modules["/semirom.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/semirom.coffee"]._cached=t.exports,function(){(function(){var t,i,n,s=Object.prototype.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=r("./common").BiromError,i=r("./move").Move,n=r("./triangle").Triangle,e.Semirom=function(){function e(t,e){this.triangles=[new n(t.u,t.v,t.w,TRI_TYPE_COUNTER,e)]}return a(e,i),e.prototype.validate=function(e){var r,i;if(r=[],i=_(this.triangles).first(),null!=e.get(i.u,i.v,i.w))throw new t("Move overlaps",EXC_BAD_REQUEST);if(0===e.getNeighbours(i).length)throw new t("Move is not connected",EXC_BAD_REQUEST);return!0},e}()}).call(this)}.call(t.exports),__require.modules["/semirom.coffee"]._cached=t.exports,t.exports},require.modules["/move.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/move.coffee"]._cached=t.exports,function(){(function(){var t,i=Object.prototype.hasOwnProperty,n=function(t,e){function r(){this.constructor=t}for(var n in e)i.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=r("./common").BiromError,e.Move=function(){function t(){t.__super__.constructor.apply(this,arguments)}return n(t,t),t.prototype.getVertices=function(){var t,e,r,i,n,s,a,o,l;for(t=[],s=this.triangles,e=0,i=s.length;i>e;e++)for(o=s[e],a=o.getVertices(),r=0,n=a.length;n>r;r++)l=a[r],_(t).any(function(t){return l.x===t.x&&l.y===t.y})||t.push(l);return t},t}()}).call(this)}.call(t.exports),__require.modules["/move.coffee"]._cached=t.exports,t.exports},require.modules["/standalone.coffee"]=function(){var t={exports:{}},e=(t.exports,function(t){return __require(t,"/")});return e.resolve=function(){return __require.resolve(name,"/")},e.modules=__require.modules,__require.modules["/standalone.coffee"]._cached=t.exports,function(){(function(){var r,i,n,s,a,o=Object.prototype.hasOwnProperty;a=e("./util"),n=a.to_uvw,s=a.to_xy,r=e("./game").Game,i=e("./semirom").Semirom,t.exports=function(){var t,e,a,l,c,u,h,f,p,d,g,m;return l=void 0,h=Raphael("paper","100%","100%"),p=60,d=$("#paper").width(),c=$("#paper").height(),g=d/2,m=c/2,e={},e[TRI_TYPE_COUNTER]={0:"#16A4FD",1:"#F8D200"},e[TRI_TYPE_POINT]={0:"#82126A",1:"#FF6E00"},e[TRI_TYPE_COMMON]={0:"black",1:"black"},u=function(){var e,i,n,s;l=new r,h.clear(),n=l.grid.triangles,s=[];for(e in n)o.call(n,e)&&(i=n[e],s.push(t(p,i.u,i.v,i.w,g,m)));return s},t=function(t,e,r,i,n,a,o){var l,c,u,f,p,d,g,m,v,y;return null==o&&(o="red"),p=Math.sqrt(3)*t/6,l=Math.sqrt(3)*t/3,u=Math.sqrt(3)*t/2,y=s(t,e,r,i),m=y[0],v=y[1],m+=n,v+=a,g=(e+r+i)%2===0,g?(f=["M",m,v-l,"L",m+t/2,v+p,"L",m-t/2,v+p,"Z"],c=Math.round(m)+"/"+Math.round(v+r*p)):(f=["M",m,v+l,"L",m+t/2,v-p,"L",m-t/2,v-p,"Z"],c=Math.round(m)+"/"+Math.round(v+r*p+p)),d=h.path(f),d.attr({fill:o,"stroke-width":.1,stroke:"white"})},a=0,f=!0,$(document).click(function(r){var s,o,c,h,d,v,y,x,b,w,_,k,C,T,E;if(f){console.debug("make move"),w=r.pageX-g-$("#paper").offset().left,_=r.pageY-m-$("#paper").offset().top,T=n(p,w,_),y=T[0],x=T[1],b=T[2],h=a%2,d=new i({u:y,v:x,w:b},h),c=[];try{c=l.put(d),a++}catch(B){if(null==B.playerWon)throw B;alert(""+B.playerWon+" won the game"),u()}for(E=[],k=0,C=c.length;C>k;k++)o=c[k],console.debug(o),E.push(function(){var r,i,n,a,l;for(n=o.triangles,l=[],r=0,i=n.length;i>r;r++)v=n[r],s=null!=(a=e[v.type][v.playerId])?a:"black",console.log(s),l.push(t(p,v.u,v.v,v.w,g,m,s));return l}());return E}}),$(document).mousemove(function(t){var e,r,i,s,a,o;return s=t.pageX-g-$("#paper").offset().left,a=t.pageY-m-$("#paper").offset().top,o=n(p,s,a),e=o[0],r=o[1],i=o[2],$("#xy").html(""+Math.round(s)+", "+Math.round(a)),$("#uvw").html(""+e+" , "+r+", "+i)}),u()}}).call(this)}.call(t.exports),__require.modules["/standalone.coffee"]._cached=t.exports,t.exports};