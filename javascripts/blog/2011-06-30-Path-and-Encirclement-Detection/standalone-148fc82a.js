var require=function(t,e){var r=require.resolve(t,e||"/"),n=require.modules[r];if(!n)throw new Error("Failed to resolve module "+t+", tried "+r);var i=n._cached?n._cached:n();return i},__require=require;require.paths=[],require.modules={},require.extensions=[".js",".coffee"],require.resolve=function(){var t=["assert","events","fs","path","vm"].reduce(function(t,e){return t[e]=!0,t},{});return function(e,r){function n(t){var e;e="/"===t?[""]:s.normalize(t).split(/\/+/);for(var r=[],n=e.length-1;n>=0;n--)if("node_modules"!==e[n]){var i=e.slice(0,n+1).join("/")+"/node_modules";r.push(i)}return r}function i(t,e){for(var r=n(e),i=0;i<r.length;i++){var s=r[i],l=a(s+"/"+t);if(l)return l;var u=o(s+"/"+t);if(u)return u}var l=a(t);return l?l:void 0}function o(t){t=t.replace(/\/+$/,"");var e=t+"/package.json";if(require.modules[e]){var r=require.modules[e](),n=r.browserify;if("object"==typeof n&&n.main){var i=a(s.resolve(t,n.main));if(i)return i}else if("string"==typeof n){var i=a(s.resolve(t,n));if(i)return i}else if(r.main){var i=a(s.resolve(t,r.main));if(i)return i}}return a(t+"/index")}function a(t){if(require.modules[t])return t;for(var e=0;e<require.extensions.length;e++){var r=require.extensions[e];if(require.modules[t+r])return t+r}}if(r||(r="/"),t[e])return e;var s=require.modules.path(),l=r||".";if(e.match(/^(?:\.\.?\/|\/)/)){var u=a(s.resolve(l,e))||o(s.resolve(l,e));if(u)return u}var c=i(e,l);if(c)return c;throw new Error("Cannot find module '"+e+"'")}}(),require.alias=function(t,e){var r=require.modules.path(),n=null;try{n=require.resolve(t+"/package.json","/")}catch(i){n=require.resolve(t,"/")}var o=r.dirname(n);Object.keys(require.modules).forEach(function(t){if(t.slice(0,o.length+1)===o+"/"){var r=t.slice(o.length);require.modules[e+r]=require.modules[o+r]}else t===o&&(require.modules[e]=require.modules[o])})},"undefined"==typeof process&&(process={}),process.nextTick||(process.nextTick=function(t){setTimeout(t,0)}),process.title||(process.title="browser"),process.binding||(process.binding=function(t){if("evals"===t)return require("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),require.modules.path=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,".")};return r.resolve=function(){return __require.resolve(name,".")},r.modules=__require.modules,__require.modules.path._cached=t.exports,function(){function t(t,e){for(var r=0,n=t.length;n>=0;n--){var i=t[n];"."==i?t.splice(n,1):".."===i?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r--;r)t.unshift("..");return t}var r=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;e.resolve=function(){for(var e="",r=!1,n=arguments.length;n>=-1&&!r;n--){var i=n>=0?arguments[n]:process.cwd();"string"==typeof i&&i&&(e=i+"/"+e,r="/"===i.charAt(0))}return e=t(e.split("/").filter(function(t){return!!t}),!r).join("/"),(r?"/":"")+e||"."},e.normalize=function(e){var r="/"===e.charAt(0),n="/"===e.slice(-1);return e=t(e.split("/").filter(function(t){return!!t}),!r).join("/"),!e&&!r&&(e="."),e&&n&&(e+="/"),(r?"/":"")+e},e.join=function(){var t=Array.prototype.slice.call(arguments,0);return e.normalize(t.filter(function(t){return t&&"string"==typeof t}).join("/"))},e.dirname=function(t){var e=r.exec(t)[1]||"",n=!1;return e?1===e.length||n&&e.length<=3&&":"===e.charAt(1)?e:e.substring(0,e.length-1):"."},e.basename=function(t,e){var n=r.exec(t)[2]||"";return e&&n.substr(-1*e.length)===e&&(n=n.substr(0,n.length-e.length)),n},e.extname=function(t){return r.exec(t)[3]||""}}.call(t.exports),__require.modules.path._cached=t.exports,t.exports},require.modules["/util.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/util.coffee"]._cached=t.exports,function(){(function(){var t,r,n,i,o,a,s;s=Math.sqrt(3),n=Math.PI/6,i=Math.PI/3,o=Math.sin(n),t=Math.cos(n),a=Math.sin(i),r=Math.cos(i),e.to_xy=function(e,r,n,i){var a,l,u,c,h,f,p,d,g,m,v;return u=s*e/6,a=s*e/3,l=s*e/2,h=0,g=r*a,f=-n*t*a,m=-n*o*a,p=i*t*a,v=-i*o*a,c=h+f+p,d=g+m+v,[c,d]},e.to_uvw=function(t,e,r){var n,o,a,l,u,c,h,f;return 0===e&&0===r?[0,0,0]:(u=s*t/6,n=s*t/3,a=s*t/2,c=Math.floor((n+r)/a),r>0?(o=-1,l=u):(o=1,l=n),h=o*Math.floor((Math.cos(i-Math.atan(e/r))*Math.sqrt(Math.pow(e,2)+Math.pow(r,2))+l)/a),r>0?(o=1,l=n):(o=-1,l=u),f=o*Math.floor((Math.cos(2*i-Math.atan(e/r))*Math.sqrt(Math.pow(e,2)+Math.pow(r,2))+l)/a),[c,h,f])},e.valid_w=function(t,e){return[t-e,t-e+1]}}).call(this)}.call(t.exports),__require.modules["/util.coffee"]._cached=t.exports,t.exports},require.modules["/game.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/game.coffee"]._cached=t.exports,function(){(function(){var t,n,i;t=r("./common").BiromError,n=r("./grid").Grid,i=r("./triangle").Triangle,e.Game=function(){function t(t){this.grid=null!=t?t:new n,this.grid.set(this.red=new i(0,0,0,TRI_TYPE_START)),this.grid.set(new i(0,1,0,TRI_TYPE_START)),this.grid.set(new i(-1,1,0,TRI_TYPE_START)),this.grid.set(new i(-1,1,1,TRI_TYPE_START))}return t.prototype.put=function(t){var e,r,n,i,o,a,s,l,u,c,h,f,p,d,g;if(n=this.grid.deepCopy(),t.validate(n))for(p=t.triangles,s=0,c=p.length;c>s;s++)a=p[s],n.set(a);for(n.fillBorderTriangles(),d=o=n.getPointTriangles(t.triangles),l=0,h=d.length;h>l;l++)i=d[l],n.set(i);for(g=e=n.getCapturedTriangles(t.triangles),u=0,f=g.length;f>u;u++)i=g[u],i.type=TRI_TYPE_COMMON,i.playerId=void 0,n.set(i);if(r=_(t.triangles).first().playerId,n.isEncircledBy(this.red,r))throw{playerWon:r};return this.grid=n.deepCopy(),[t,{triangles:e},{triangles:o}]},t}()}).call(this)}.call(t.exports),__require.modules["/game.coffee"]._cached=t.exports,t.exports},require.modules["/common.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/common.coffee"]._cached=t.exports,function(){(function(){var t;t="undefined"!=typeof global&&null!==global?global:window,t._=r("underscore"),t.TRI_TYPE_START=0,t.TRI_TYPE_COMMON=1,t.TRI_TYPE_POINT=2,t.TRI_TYPE_COUNTER=3,t.TRI_TYPE_BORDER=4,t.EXC_BAD_REQUEST=400,t.EXC_ERROR=500,e.BiromError=function(){function t(t,e){this.message=null!=t?t:"Undefined Error",this.code=null!=e?e:EXC_ERROR}return t.prototype.toString=function(){return""+this.message+" ["+this.code+"]"},t}(),e.bfs=function(t,r){var n,i,o,a,s,l;for(s=[],s.unshift(t),a=1e3,o=0,l=[];!_(s).isEmpty();){if(++o===a)throw new e.BiromError("Endless loop in BFS ("+o+" iterations)",EXC_ERROR);n=s.pop(),l.push(function(){var t,e,o,a;for(o=r(n),a=[],t=0,e=o.length;e>t;t++)i=o[t],a.push(s.unshift(i));return a}())}return l},e.isWithin=function(t,e,r){var n,i,o;return _([t.u,e.u]).min()<=(n=r.u)&&n<=_([t.u,e.u]).max()&&_([t.v,e.v]).min()<=(i=r.v)&&i<=_([t.v,e.v]).max()&&_([t.w,e.w]).min()<=(o=r.w)&&o<=_([t.w,e.w]).max()}}).call(this)}.call(t.exports),__require.modules["/common.coffee"]._cached=t.exports,t.exports},require.modules["/node_modules/underscore/package.json"]=function(){var t={exports:{}},e=(t.exports,function(t){return __require(t,"/node_modules/underscore")});return e.resolve=function(){return __require.resolve(name,"/node_modules/underscore")},e.modules=__require.modules,__require.modules["/node_modules/underscore/package.json"]._cached=t.exports,function(){t.exports={name:"underscore",description:"JavaScript's functional programming helper library.",homepage:"http://documentcloud.github.com/underscore/",keywords:["util","functional","server","client","browser"],author:"Jeremy Ashkenas <jeremy@documentcloud.org>",contributors:[],dependencies:[],repository:{type:"git",url:"git://github.com/documentcloud/underscore.git"},main:"underscore.js",version:"1.1.6"}}.call(t.exports),__require.modules["/node_modules/underscore/package.json"]._cached=t.exports,t.exports},require.modules["/node_modules/underscore/underscore.js"]=function(){var t={exports:{}},e=(t.exports,function(t){return __require(t,"/node_modules/underscore")});return e.resolve=function(){return __require.resolve(name,"/node_modules/underscore")},e.modules=__require.modules,__require.modules["/node_modules/underscore/underscore.js"]._cached=t.exports,function(){!function(){var e=this,r=e._,n={},i=Array.prototype,o=Object.prototype,a=Function.prototype,s=i.slice,l=i.unshift,u=o.toString,c=o.hasOwnProperty,h=i.forEach,f=i.map,p=i.reduce,d=i.reduceRight,g=i.filter,m=i.every,v=i.some,y=i.indexOf,b=i.lastIndexOf,x=Array.isArray,_=Object.keys,w=a.bind,k=function(t){return new S(t)};"undefined"!=typeof t&&t.exports?(t.exports=k,k._=k):e._=k,k.VERSION="1.1.6";var E=k.each=k.forEach=function(t,e,r){if(null!=t)if(h&&t.forEach===h)t.forEach(e,r);else if(k.isNumber(t.length)){for(var i=0,o=t.length;o>i;i++)if(e.call(r,t[i],i,t)===n)return}else for(var a in t)if(c.call(t,a)&&e.call(r,t[a],a,t)===n)return};k.map=function(t,e,r){var n=[];return null==t?n:f&&t.map===f?t.map(e,r):(E(t,function(t,i,o){n[n.length]=e.call(r,t,i,o)}),n)},k.reduce=k.foldl=k.inject=function(t,e,r,n){var i=void 0!==r;if(null==t&&(t=[]),p&&t.reduce===p)return n&&(e=k.bind(e,n)),i?t.reduce(e,r):t.reduce(e);if(E(t,function(t,o,a){i||0!==o?r=e.call(n,r,t,o,a):(r=t,i=!0)}),!i)throw new TypeError("Reduce of empty array with no initial value");return r},k.reduceRight=k.foldr=function(t,e,r,n){if(null==t&&(t=[]),d&&t.reduceRight===d)return n&&(e=k.bind(e,n)),void 0!==r?t.reduceRight(e,r):t.reduceRight(e);var i=(k.isArray(t)?t.slice():k.toArray(t)).reverse();return k.reduce(i,e,r,n)},k.find=k.detect=function(t,e,r){var n;return T(t,function(t,i,o){return e.call(r,t,i,o)?(n=t,!0):void 0}),n},k.filter=k.select=function(t,e,r){var n=[];return null==t?n:g&&t.filter===g?t.filter(e,r):(E(t,function(t,i,o){e.call(r,t,i,o)&&(n[n.length]=t)}),n)},k.reject=function(t,e,r){var n=[];return null==t?n:(E(t,function(t,i,o){e.call(r,t,i,o)||(n[n.length]=t)}),n)},k.every=k.all=function(t,e,r){var i=!0;return null==t?i:m&&t.every===m?t.every(e,r):(E(t,function(t,o,a){return(i=i&&e.call(r,t,o,a))?void 0:n}),i)};var T=k.some=k.any=function(t,e,r){e||(e=k.identity);var i=!1;return null==t?i:v&&t.some===v?t.some(e,r):(E(t,function(t,o,a){return(i=e.call(r,t,o,a))?n:void 0}),i)};k.include=k.contains=function(t,e){var r=!1;return null==t?r:y&&t.indexOf===y?-1!=t.indexOf(e):(T(t,function(t){return(r=t===e)?!0:void 0}),r)},k.invoke=function(t,e){var r=s.call(arguments,2);return k.map(t,function(t){return(e.call?e||t:t[e]).apply(t,r)})},k.pluck=function(t,e){return k.map(t,function(t){return t[e]})},k.max=function(t,e,r){if(!e&&k.isArray(t))return Math.max.apply(Math,t);var n={computed:-1/0};return E(t,function(t,i,o){var a=e?e.call(r,t,i,o):t;a>=n.computed&&(n={value:t,computed:a})}),n.value},k.min=function(t,e,r){if(!e&&k.isArray(t))return Math.min.apply(Math,t);var n={computed:1/0};return E(t,function(t,i,o){var a=e?e.call(r,t,i,o):t;a<n.computed&&(n={value:t,computed:a})}),n.value},k.sortBy=function(t,e,r){return k.pluck(k.map(t,function(t,n,i){return{value:t,criteria:e.call(r,t,n,i)}}).sort(function(t,e){var r=t.criteria,n=e.criteria;return n>r?-1:r>n?1:0}),"value")},k.sortedIndex=function(t,e,r){r||(r=k.identity);for(var n=0,i=t.length;i>n;){var o=n+i>>1;r(t[o])<r(e)?n=o+1:i=o}return n},k.toArray=function(t){return t?t.toArray?t.toArray():k.isArray(t)?t:k.isArguments(t)?s.call(t):k.values(t):[]},k.size=function(t){return k.toArray(t).length},k.first=k.head=function(t,e,r){return null==e||r?t[0]:s.call(t,0,e)},k.rest=k.tail=function(t,e,r){return s.call(t,null==e||r?1:e)},k.last=function(t){return t[t.length-1]},k.compact=function(t){return k.filter(t,function(t){return!!t})},k.flatten=function(t){return k.reduce(t,function(t,e){return k.isArray(e)?t.concat(k.flatten(e)):(t[t.length]=e,t)},[])},k.without=function(t){var e=s.call(arguments,1);return k.filter(t,function(t){return!k.include(e,t)})},k.uniq=k.unique=function(t,e){return k.reduce(t,function(t,r,n){return 0!=n&&(e===!0?k.last(t)==r:k.include(t,r))||(t[t.length]=r),t},[])},k.intersect=function(t){var e=s.call(arguments,1);return k.filter(k.uniq(t),function(t){return k.every(e,function(e){return k.indexOf(e,t)>=0})})},k.zip=function(){for(var t=s.call(arguments),e=k.max(k.pluck(t,"length")),r=Array(e),n=0;e>n;n++)r[n]=k.pluck(t,""+n);return r},k.indexOf=function(t,e,r){if(null==t)return-1;var n,i;if(r)return n=k.sortedIndex(t,e),t[n]===e?n:-1;if(y&&t.indexOf===y)return t.indexOf(e);for(n=0,i=t.length;i>n;n++)if(t[n]===e)return n;return-1},k.lastIndexOf=function(t,e){if(null==t)return-1;if(b&&t.lastIndexOf===b)return t.lastIndexOf(e);for(var r=t.length;r--;)if(t[r]===e)return r;return-1},k.range=function(t,e,r){arguments.length<=1&&(e=t||0,t=0),r=arguments[2]||1;for(var n=Math.max(Math.ceil((e-t)/r),0),i=0,o=Array(n);n>i;)o[i++]=t,t+=r;return o},k.bind=function(t,e){if(t.bind===w&&w)return w.apply(t,s.call(arguments,1));var r=s.call(arguments,2);return function(){return t.apply(e,r.concat(s.call(arguments)))}},k.bindAll=function(t){var e=s.call(arguments,1);return 0==e.length&&(e=k.functions(t)),E(e,function(e){t[e]=k.bind(t[e],t)}),t},k.memoize=function(t,e){var r={};return e||(e=k.identity),function(){var n=e.apply(this,arguments);return c.call(r,n)?r[n]:r[n]=t.apply(this,arguments)}},k.delay=function(t,e){var r=s.call(arguments,2);return setTimeout(function(){return t.apply(t,r)},e)},k.defer=function(t){return k.delay.apply(k,[t,1].concat(s.call(arguments,1)))};var C=function(t,e,r){var n;return function(){var i=this,o=arguments,a=function(){n=null,t.apply(i,o)};r&&clearTimeout(n),(r||!n)&&(n=setTimeout(a,e))}};k.throttle=function(t,e){return C(t,e,!1)},k.debounce=function(t,e){return C(t,e,!0)},k.once=function(t){var e,r=!1;return function(){return r?e:(r=!0,e=t.apply(this,arguments))}},k.wrap=function(t,e){return function(){var r=[t].concat(s.call(arguments));return e.apply(this,r)}},k.compose=function(){var t=s.call(arguments);return function(){for(var e=s.call(arguments),r=t.length-1;r>=0;r--)e=[t[r].apply(this,e)];return e[0]}},k.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},k.keys=_||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var r in t)c.call(t,r)&&(e[e.length]=r);return e},k.values=function(t){return k.map(t,k.identity)},k.functions=k.methods=function(t){return k.filter(k.keys(t),function(e){return k.isFunction(t[e])}).sort()},k.extend=function(t){return E(s.call(arguments,1),function(e){for(var r in e)void 0!==e[r]&&(t[r]=e[r])}),t},k.defaults=function(t){return E(s.call(arguments,1),function(e){for(var r in e)null==t[r]&&(t[r]=e[r])}),t},k.clone=function(t){return k.isArray(t)?t.slice():k.extend({},t)},k.tap=function(t,e){return e(t),t},k.isEqual=function(t,e){if(t===e)return!0;var r=typeof t,n=typeof e;if(r!=n)return!1;if(t==e)return!0;if(!t&&e||t&&!e)return!1;if(t._chain&&(t=t._wrapped),e._chain&&(e=e._wrapped),t.isEqual)return t.isEqual(e);if(k.isDate(t)&&k.isDate(e))return t.getTime()===e.getTime();if(k.isNaN(t)&&k.isNaN(e))return!1;if(k.isRegExp(t)&&k.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.ignoreCase===e.ignoreCase&&t.multiline===e.multiline;if("object"!==r)return!1;if(t.length&&t.length!==e.length)return!1;var i=k.keys(t),o=k.keys(e);if(i.length!=o.length)return!1;for(var a in t)if(!(a in e&&k.isEqual(t[a],e[a])))return!1;return!0},k.isEmpty=function(t){if(k.isArray(t)||k.isString(t))return 0===t.length;for(var e in t)if(c.call(t,e))return!1;return!0},k.isElement=function(t){return!!t&&1==t.nodeType},k.isArray=x||function(t){return"[object Array]"===u.call(t)},k.isArguments=function(t){return!!t&&!!c.call(t,"callee")},k.isFunction=function(t){return!!(t&&t.constructor&&t.call&&t.apply)},k.isString=function(t){return!!(""===t||t&&t.charCodeAt&&t.substr)},k.isNumber=function(t){return!!(0===t||t&&t.toExponential&&t.toFixed)},k.isNaN=function(t){return t!==t},k.isBoolean=function(t){return t===!0||t===!1},k.isDate=function(t){return!!(t&&t.getTimezoneOffset&&t.setUTCFullYear)},k.isRegExp=function(t){return!(!(t&&t.test&&t.exec)||!t.ignoreCase&&t.ignoreCase!==!1)},k.isNull=function(t){return null===t},k.isUndefined=function(t){return void 0===t},k.noConflict=function(){return e._=r,this},k.identity=function(t){return t},k.times=function(t,e,r){for(var n=0;t>n;n++)e.call(r,n)},k.mixin=function(t){E(k.functions(t),function(e){A(e,k[e]=t[e])})};var q=0;k.uniqueId=function(t){var e=q++;return t?t+e:e},k.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g},k.template=function(t,e){var r=k.templateSettings,n="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+t.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(r.interpolate,function(t,e){return"',"+e.replace(/\\'/g,"'")+",'"}).replace(r.evaluate||null,function(t,e){return"');"+e.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+"__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",i=new Function("obj",n);return e?i(e):i};var S=function(t){this._wrapped=t};k.prototype=S.prototype;var M=function(t,e){return e?k(t).chain():t},A=function(t,e){S.prototype[t]=function(){var t=s.call(arguments);return l.call(t,this._wrapped),M(e.apply(k,t),this._chain)}};k.mixin(k),E(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=i[t];S.prototype[t]=function(){return e.apply(this._wrapped,arguments),M(this._wrapped,this._chain)}}),E(["concat","join","slice"],function(t){var e=i[t];S.prototype[t]=function(){return M(e.apply(this._wrapped,arguments),this._chain)}}),S.prototype.chain=function(){return this._chain=!0,this},S.prototype.value=function(){return this._wrapped}}()}.call(t.exports),__require.modules["/node_modules/underscore/underscore.js"]._cached=t.exports,t.exports},require.modules["/grid.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/grid.coffee"]._cached=t.exports,function(){(function(){var t,n,i,o,a=Object.prototype.hasOwnProperty,s=function(t,e){return function(){return t.apply(e,arguments)}},l=Array.prototype.indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(this[e]===t)return e;return-1};o=r("./common"),n=o.bfs,i=o.isWithin,t=r("./triangle").Triangle,e.Grid=function(){function e(t){this.triangles=null!=t?t:{}}return e.prototype.set=function(e){if(!(e instanceof t))throw new BiromError("Argument is not a triangle",EXC_BAD_REQUEST);return this.triangles[""+e]=e},e.prototype.get=function(t,e,r){return this.triangles[""+t+"/"+e+"/"+r]},e.prototype.getNeighbours=function(t){var e,r;return r=function(){var r,n,i,o;for(i=t.getNeighbourCoords(),o=[],r=0,n=i.length;n>r;r++)e=i[r],o.push(this.get(e.u,e.v,e.w));return o}.call(this),_(r).compact()},e.prototype.getCloseNeighbours=function(t){var e,r;return r=function(){var r,n,i,o;for(i=t.getCloseNeighbourCoords(),o=[],r=0,n=i.length;n>r;r++)e=i[r],o.push(this.get(e.u,e.v,e.w));return o}.call(this),_(r).compact()},e.prototype.getBoundingBox=function(){var t,e,r,n,i,o;return i=_(this.triangles).pluck("u"),o=_(this.triangles).pluck("v"),[{u:t=_(i).max(),v:e=_(o).max(),w:-t-e},{u:r=_(i).min(),v:n=_(o).min(),w:1-r-n}]},e.prototype.deepCopy=function(){var r,n,i,o;n={},o=this.triangles;for(r in o)a.call(o,r)&&(i=o[r],i.type!==TRI_TYPE_BORDER&&(n[r]=new t(i.u,i.v,i.w,i.type,i.playerId)));return new e(n)},e.prototype.fillBorderTriangles=function(){var e,r,o,a,l;return l=this.getBoundingBox(),e=l[0],o=l[1],a=new t(e.u+1,e.v+1,e.w-2,TRI_TYPE_BORDER),r=new t(o.u-1,o.v-1,o.w+2,TRI_TYPE_BORDER),this.set(a),n(a,s(function(e){var n,o,s,l,u,c;for(u=e.getCloseNeighbourCoords(),c=[],s=0,l=u.length;l>s;s++)n=u[s],i(a,r,n)&&null==this.get(n.u,n.v,n.w)&&(o=new t(n.u,n.v,n.w,TRI_TYPE_BORDER),this.set(o),c.push(o));return c},this))},e.prototype.getPointTriangles=function(e){var r,i,o,a,u;if(!_(e).isArray())throw new BiromError("Argument is not an array",EXC_BAD_REQUEST);return r=function(){var t,r,n;for(n=[],t=0,r=e.length;r>t;t++)i=e[t],n.push(""+i.u+"/"+i.v+"/"+i.w);return n}(),o={},a=[],u=_(e).first(),n(u,s(function(e){var n,i,s,c;return s=function(){var t,i,a,s,u;for(a=e.getCloseNeighbourCoords(),u=[],t=0,i=a.length;i>t;t++)n=a[t],(null==this.get(n.u,n.v,n.w)||(s=""+n.u+"/"+n.v+"/"+n.w,l.call(r,s)>=0))&&!o[""+n.u+"/"+n.v+"/"+n.w]&&u.push(n);return u}.call(this),c=function(){var e,r,l;for(l=[],e=0,r=s.length;r>e;e++)n=s[e],o[""+n.u+"/"+n.v+"/"+n.w]=!0,i=this.get(n.u,n.v,n.w),null==i&&(i=new t(n.u,n.v,n.w,TRI_TYPE_POINT,u.playerId),a.push(i)),l.push(i);return l}.call(this)},this)),a},e.prototype.isEncircledBy=function(t,e){var r,i;if(i={},t.type!==TRI_TYPE_START)throw new BiromError("Argument is not a red birom triangle",EXC_BAD_REQUEST);r=!0;try{n(t,s(function(t){var r,n,o,a,s;for(n=[],s=this.getCloseNeighbours(t),o=0,a=s.length;a>o;o++){if(r=s[o],r.type===TRI_TYPE_BORDER)throw"BorderReached";(r.type===TRI_TYPE_START||r.type===TRI_TYPE_COUNTER&&r.playerId!==e)&&!i[""+r.u+"/"+r.v+"/"+r.w]&&n.push(r),i[""+r.u+"/"+r.v+"/"+r.w]=!0}return n},this))}catch(o){if("BorderReached"!==o)throw o;r=!1}return r},e.prototype._getCapturedBranch=function(t){var e,r;r={},e=[],r[""+t.u+"/"+t.v+"/"+t.w]=!0;try{n(t,s(function(t){var n,i,o,a,s;for(e.push(t),i=this.getCloseNeighbours(t),o=[],a=0,s=i.length;s>a;a++){if(n=i[a],n.type===TRI_TYPE_BORDER)throw"EndOfBranch";n.type===TRI_TYPE_COUNTER&&n.playerId===t.playerId&&!r[""+n.u+"/"+n.v+"/"+n.w]&&o.push(n),r[""+n.u+"/"+n.v+"/"+n.w]=!0}return o},this))}catch(i){if("EndOfBranch"!==i)throw i;e=[]}return e},e.prototype.getCapturedTriangles=function(t){var e,r,i,o,a;if(!_(t).isArray())throw new BiromError("Argument is not an array",EXC_BAD_REQUEST);return r=function(){var e,r,n;for(n=[],e=0,r=t.length;r>e;e++)i=t[e],n.push(""+i.u+"/"+i.v+"/"+i.w);return n}(),o={},a=_(t).first(),e=[],n(a,s(function(t){var n,i,s,u,c,h,f;for(u=this.getCloseNeighbours(t),c=function(){var t,e,n,i;for(i=[],t=0,e=u.length;e>t;t++)s=u[t],(s.type===TRI_TYPE_POINT&&s.playerId===a.playerId||(n=""+s.u+"/"+s.v+"/"+s.w,l.call(r,n)>=0))&&!o[""+s.u+"/"+s.v+"/"+s.w]&&(o[""+s.u+"/"+s.v+"/"+s.w]=!0,i.push(s));return i}(),n=function(){var e,r,n;for(n=[],e=0,r=u.length;r>e;e++)s=u[e],s.type===TRI_TYPE_COUNTER&&s.playerId!==t.playerId&&!o[""+s]&&n.push(s);return n}(),h=0,f=n.length;f>h;h++)i=n[h],o[""+i.u+"/"+i.v+"/"+i.w]=!0,e.push(this._getCapturedBranch(i));return c},this)),_(e).flatten()},e}()}).call(this)}.call(t.exports),__require.modules["/grid.coffee"]._cached=t.exports,t.exports},require.modules["/triangle.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/triangle.coffee"]._cached=t.exports,function(){(function(){var t;t=r("./common").BiromError,e.Triangle=function(){function e(e,r,n,i,o){var a;if(this.type=i,this.playerId=o,this.u=parseInt(e),this.v=parseInt(r),this.w=parseInt(n),null==this.u||null==this.v||null==this.w||_.isNaN(this.u)||_.isNaN(this.v)||_.isNaN(this.w))throw new t("Invalid or missing coordinates",EXC_BAD_REQUEST);if(!(0<=(a=this.u+this.v+this.w)&&1>=a))throw new t("Invalid coordinates",EXC_BAD_REQUEST)}return e.prototype.isFacingUp=function(){return this.u+this.v+this.w===0},e.prototype.isCloseNeighbour=function(t){return Math.abs(this.u-t.u)+Math.abs(this.v-t.v)+Math.abs(this.w-t.w)===1},e.prototype.getNeighbourCoords=function(){var t,e,r,n,i,o,a,s,l,u,c;for(t=[],l=e=this.u-1,r=this.u+1;r>=e?r>=l:l>=r;r>=e?l++:l--)for(u=n=this.v-1,i=this.v+1;i>=n?i>=u:u>=i;i>=n?u++:u--)for(c=o=this.w-1,a=this.w+1;a>=o?a>=c:c>=a;a>=o?c++:c--)0<=(s=l+u+c)&&1>=s&&(l!==this.u||u!==this.v||c!==this.w)&&t.push({u:l,v:u,w:c});return t},e.prototype.getCloseNeighbourCoords=function(){var t;return t=this.isFacingUp()?1:-1,[{u:this.u+t,v:this.v,w:this.w},{u:this.u,v:this.v+t,w:this.w},{u:this.u,v:this.v,w:this.w+t}]},e.prototype.getVertices=function(){return this.isFacingUp()?[{x:this.u,y:this.v},{x:this.u-1,y:this.v},{x:this.u,y:this.v-1}]:[{x:this.u,y:this.v-1},{x:this.u-1,y:this.v},{x:this.u-1,y:this.v-1}]},e.prototype.toString=function(){return""+this.u+"/"+this.v+"/"+this.w},e}()}).call(this)}.call(t.exports),__require.modules["/triangle.coffee"]._cached=t.exports,t.exports},require.modules["/semirom.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/semirom.coffee"]._cached=t.exports,function(){(function(){var t,n,i,o=Object.prototype.hasOwnProperty,a=function(t,e){function r(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=r("./common").BiromError,n=r("./move").Move,i=r("./triangle").Triangle,e.Semirom=function(){function e(t,e){this.triangles=[new i(t.u,t.v,t.w,TRI_TYPE_COUNTER,e)]}return a(e,n),e.prototype.validate=function(e){var r,n;if(r=[],n=_(this.triangles).first(),null!=e.get(n.u,n.v,n.w))throw new t("Move overlaps",EXC_BAD_REQUEST);if(0===e.getNeighbours(n).length)throw new t("Move is not connected",EXC_BAD_REQUEST);return!0},e}()}).call(this)}.call(t.exports),__require.modules["/semirom.coffee"]._cached=t.exports,t.exports},require.modules["/move.coffee"]=function(){var t={exports:{}},e=t.exports,r=function(t){return __require(t,"/")};return r.resolve=function(){return __require.resolve(name,"/")},r.modules=__require.modules,__require.modules["/move.coffee"]._cached=t.exports,function(){(function(){var t,n=Object.prototype.hasOwnProperty,i=function(t,e){function r(){this.constructor=t}for(var i in e)n.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=r("./common").BiromError,e.Move=function(){function t(){t.__super__.constructor.apply(this,arguments)}return i(t,t),t.prototype.getVertices=function(){var t,e,r,n,i,o,a,s,l;for(t=[],o=this.triangles,e=0,n=o.length;n>e;e++)for(s=o[e],a=s.getVertices(),r=0,i=a.length;i>r;r++)l=a[r],_(t).any(function(t){return l.x===t.x&&l.y===t.y})||t.push(l);return t},t}()}).call(this)}.call(t.exports),__require.modules["/move.coffee"]._cached=t.exports,t.exports},require.modules["/standalone.coffee"]=function(){var t={exports:{}},e=(t.exports,function(t){return __require(t,"/")});return e.resolve=function(){return __require.resolve(name,"/")},e.modules=__require.modules,__require.modules["/standalone.coffee"]._cached=t.exports,function(){(function(){var r,n,i,o,a,s=Object.prototype.hasOwnProperty;a=e("./util"),i=a.to_uvw,o=a.to_xy,r=e("./game").Game,n=e("./semirom").Semirom,t.exports=function(){var t,e,a,l,u,c,h,f,p,d,g,m;return l=void 0,h=Raphael("paper","100%","100%"),p=60,d=$("#paper").width(),u=$("#paper").height(),g=d/2,m=u/2,e={},e[TRI_TYPE_COUNTER]={0:"#16A4FD",1:"#F8D200"},e[TRI_TYPE_POINT]={0:"#82126A",1:"#FF6E00"},e[TRI_TYPE_COMMON]={0:"black",1:"black"},c=function(){var e,n,i,o;l=new r,h.clear(),i=l.grid.triangles,o=[];for(e in i)s.call(i,e)&&(n=i[e],o.push(t(p,n.u,n.v,n.w,g,m)));return o},t=function(t,e,r,n,i,a,s){var l,u,c,f,p,d,g,m,v,y;return null==s&&(s="red"),p=Math.sqrt(3)*t/6,l=Math.sqrt(3)*t/3,c=Math.sqrt(3)*t/2,y=o(t,e,r,n),m=y[0],v=y[1],m+=i,v+=a,g=(e+r+n)%2===0,g?(f=["M",m,v-l,"L",m+t/2,v+p,"L",m-t/2,v+p,"Z"],u=Math.round(m)+"/"+Math.round(v+r*p)):(f=["M",m,v+l,"L",m+t/2,v-p,"L",m-t/2,v-p,"Z"],u=Math.round(m)+"/"+Math.round(v+r*p+p)),d=h.path(f),d.attr({fill:s,"stroke-width":.1,stroke:"white"})},a=0,f=!0,$(document).click(function(r){var o,s,u,h,d,v,y,b,x,_,w,k,E,T,C;if(f){console.debug("make move"),_=r.pageX-g-$("#paper").offset().left,w=r.pageY-m-$("#paper").offset().top,T=i(p,_,w),y=T[0],b=T[1],x=T[2],h=a%2,d=new n({u:y,v:b,w:x},h),u=[];try{u=l.put(d),a++}catch(q){if(null==q.playerWon)throw q;alert(""+q.playerWon+" won the game"),c()}for(C=[],k=0,E=u.length;E>k;k++)s=u[k],console.debug(s),C.push(function(){var r,n,i,a,l;for(i=s.triangles,l=[],r=0,n=i.length;n>r;r++)v=i[r],o=null!=(a=e[v.type][v.playerId])?a:"black",console.log(o),l.push(t(p,v.u,v.v,v.w,g,m,o));return l}());return C}}),$(document).mousemove(function(t){var e,r,n,o,a,s;return o=t.pageX-g-$("#paper").offset().left,a=t.pageY-m-$("#paper").offset().top,s=i(p,o,a),e=s[0],r=s[1],n=s[2],$("#xy").html(""+Math.round(o)+", "+Math.round(a)),$("#uvw").html(""+e+" , "+r+", "+n)}),c()}}).call(this)}.call(t.exports),__require.modules["/standalone.coffee"]._cached=t.exports,t.exports};